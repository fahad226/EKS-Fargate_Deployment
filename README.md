# EKS-Fargate_Deployment

This project demonstrates deploying an application on an Amazon EKS (Elastic Kubernetes Service) cluster using `eksctl` and setting up an Application Load Balancer (ALB) Ingress Controller for external access.

## Prerequisites

To interact with an EKS cluster, ensure the following tools are installed:

1. **eksctl**: To create and manage EKS clusters.[Download eksctl](https://eksctl.io/)
2. **kubectl**: To manage Kubernetes clusters. [Download kubectl](https://kubernetes.io/docs/tasks/tools/#kubectl)
3. **AWS CLI**: To interact with AWS services. [Download AWS CLI](https://aws.amazon.com/cli/)
4. **AWS Configure**: Set up AWS credentials with `aws configure`.
5. **Helm**:A package manager for Kubernetes, used here to install the AWS Load Balancer (ALB) Ingress Controller. [Download Helm](https://helm.sh/docs/intro/install/)
---

## Steps to Set Up the EKS Cluster and Deploy the Application

### 1. Create an EKS Cluster

Use `eksctl` to create a new EKS cluster with Fargate (serverless Kubernetes) enabled:

```bash
eksctl create cluster --name demo-cluster --region us-east-1 --fargate
```
![Image Description](path/to/image.png)

This command creates a managed EKS cluster named demo-cluster in the us-east-1 region.

### 2. Update kubeconfig

To access the new EKS cluster, update your kubeconfig:

```
aws eks update-kubeconfig --name demo-cluster --region us-east-1
```
After this, you should be able to run kubectl commands on your cluster.

### 3. Deploy the Application in a Fargate Profile
Define a Fargate profile for the application:

```Copy code
eksctl create fargateprofile \
    --cluster demo-cluster \
    --region us-east-1 \
    --name alb-sample-app \
    --namespace game-2048
```
This command creates a new namespace (game-2048) where we will deploy the application.

![Image Description](path/to/image.png)

### 4. Deploy Application Resources
To deploy the application and its associated resources, apply the following manifest file:

```
kubectl apply -f https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.5.4/docs/examples/2048/2048_full.yaml
```

This manifest deploys the application in the game-2048 namespace.

To verify that all resources are running, check the deployment:

```
kubectl get pods -n game-2048
kubectl get svc -n game-2048
```
![Image Description](path/to/image.png)

## Setting Up the ALB Ingress Controller
To expose the application to external users, we need an ALB Ingress Controller.

### 1. Create IAM OIDC Provider
The ALB controller requires IAM access. Associate an IAM OIDC provider with the EKS cluster:

```
eksctl utils associate-iam-oidc-provider --cluster demo-cluster --approve
```
![Image Description](path/to/image.png)

### 2. Create IAM Policy for ALB Controller
Download the required IAM policy for the ALB controller:

```
curl -O https://raw.githubusercontent.com/kubernetes-sigs/aws-load-balancer-controller/v2.5.4/docs/install/iam_policy.json
```

![Image Description](path/to/image.png)

### 3. Create IAM Service Account
Use eksctl to create an IAM service account with the necessary permissions:

```eksctl create iamserviceaccount \
  --cluster=demo-cluster \
  --namespace=kube-system \
  --name=aws-load-balancer-controller \
  --role-name AmazonEKSLoadBalancerControllerRole \
  --attach-policy-arn=arn:aws:iam::<your-aws-account-id>:policy/AWSLoadBalancerControllerIAMPolicy \
  --approve
```

Note: Replace <your-aws-account-id> with your AWS account ID.

### 4. Install ALB Ingress Controller with Helm
Add the AWS EKS Helm chart repository:

```
helm repo add eks https://aws.github.io/eks-charts
helm repo update
```

Install the ALB Ingress Controller using Helm:

```
helm install aws-load-balancer-controller eks/aws-load-balancer-controller \
  -n kube-system \
  --set clusterName=demo-cluster \
  --set serviceAccount.create=false \
  --set serviceAccount.name=aws-load-balancer-controller \
  --set region=us-east-1 \
  --set vpcId=<your-vpc-id>
```
Note: Replace your-vpc-id with your VPC ID.

5. Verify ALB Ingress Controller Deployment
Check the ALB controller deployment:

```
kubectl get deployment -n kube-system aws-load-balancer-controller
```
The ALB Ingress Controller should be running, and an ALB (Application Load Balancer) with a DNS endpoint will be created for your application.

## Additional Verification
### Check DNS
Verify that the DNS name generated by the ALB is working by accessing it through a web browser.

### Check Pods and Services
Ensure that all application pods and services are running correctly:

```
kubectl get pods -n game-2048
kubectl get svc -n game-2048
```
## Project Completion
Your EKS cluster and application are now successfully deployed with an ALB Ingress Controller. The application is accessible via the DNS name provided by the ALB.
